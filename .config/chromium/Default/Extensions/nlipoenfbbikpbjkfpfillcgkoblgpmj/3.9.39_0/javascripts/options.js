var Bg=chrome.extension.getBackgroundPage();function buildSelect(){for(var t=["V","S","E"],e=$('<select disabled="disabled"></select>'),a=48;a<91;a++)if(!(57<a&&a<65)){var c=String.fromCharCode(a);$("<option></option>").attr({value:c}).text(c).appendTo(e)}e.appendTo($(".select")).each(function(e){this.value=t[e]})}function bindSelect(){$("#shortcuts_table").click(function(e){var t=e.target,a=$(t).parent().siblings("td");if("SELECT"==t.tagName&&$("input",a).attr("checked")&&$("select",$("#menu_shortcuts")).not(t).each(function(){$("option[disabled]",$(this)).removeAttr("disabled"),$("option[value="+this.value+"]",$(t)).attr({disabled:"disabled"})}),"checkbox"==t.type){var c=$("select",a);$(t).attr("checked")?c.removeAttr("disabled"):c.attr({disabled:"disabled"})}})}function bindActionPanel(){$("#action_panel").click(function(e){if("INPUT"==e.target.tagName)switch(e.target.value){case"Reset":localStorage.clear(),localStorage.reset=!0,location.href=location.href,localStorage.msObj='{"visible":{"enable":true,"key":"V"},"selected":{"enable":true,"key":"S"},"entire":{"enable":true,"key":"E"}}',localStorage.format="png",localStorage.savePath="C:/",localStorage.autoSave="false",localStorage["gmail-btn"]="true";break;case"Save":if(checkDuplicateKeys())return $("#tip").addClass("error"),void showTip("Shortcut Keys Conflict");saveOptions(),$("#tip").removeClass("error"),showTip("Options Saved");break;case"Close":chrome.extension.sendRequest({action:"exit"})}})}function saveOptions(){localStorage.format=$('input[name="format"]:checked').attr("id"),localStorage.delay_sec=$('input[name="delay_sec"]:checked').attr("data-sec"),localStorage.autoSave=$("#autosave").is(":checked"),localStorage["data-tracking"]=$("#data-tracking").is(":checked"),localStorage["gmail-btn"]=$("#gmail-btn").prop("checked");var c={};$("input:checkbox",$("#menu_shortcuts")).each(function(){var e=this.id,t=this.checked,a=$("select",$(this).parent().siblings("td.select")).attr("value");c[""+e]={enable:t,key:a}}),$("input:checkbox",$("#menu_features")).each(function(){var e=this.id,t=this.checked,a=$("select",$(this).parent().siblings("td.select")).attr("value");c[""+e]={enable:t,key:a}}),localStorage.msObj=JSON.stringify(c),chrome.extension.sendRequest({action:"update_shortcuts"})}function restoreOptions(){if(localStorage.format?$("#"+localStorage.format).attr({checked:"checked"}).siblings("input:checked").removeAttr("checked"):(localStorage.format="png",$("#png").attr({checked:"checked"}).siblings("input:checked").removeAttr("checked")),localStorage.delay_sec&&$("#delay_sec_"+localStorage.delay_sec).attr({checked:"checked"}).siblings("input:checked").removeAttr("checked"),"true"==localStorage["gmail-btn"]&&$("#gmail-btn").prop("checked",!0),"true"==localStorage["data-tracking"]&&$("#data-tracking").attr({checked:"checked"}),localStorage.savePath&&$("#filePath").val(localStorage.savePath),"true"==localStorage.autoSave&&$("#autosave").prop("checked",!0),msObj=localStorage.msObj)for(var e in msObj=JSON.parse(msObj),msObj){var t=msObj[e],a=$("#"+e),c=$("select",a.parent().siblings("td.select"));t.enable&&(a.attr({checked:"checked"}),c.removeAttr("disabled")),c.attr({value:t.key})}}function checkDuplicateKeys(){var t="",a=0;return $("select",$("td.select")).each(function(){var e=this.value;1<(t+=e).match(new RegExp(e,"gi")).length&&(a=1)}),a}function showTip(e){$("#tip").slideDown("fast").delay(2e3).fadeOut("slow").find("span").text(e)}$(document).ready(function(){localStorage.reset&&"true"==localStorage.reset&&(showTip("Options Reseted"),localStorage.removeItem("reset"));var e=document.getElementById("pluginobj");buildSelect(),restoreOptions(),bindSelect(),bindActionPanel(),$("#browsePath").on("click",function(){e.SetSavePath(localStorage.savePath,function(e){$("#filePath").val(e),localStorage.savePath=e},"Browse...")}),$("#goToFolder").on("click",function(){e.OpenSavePath(localStorage.savePath)}),$("#addition-learn-more").on("click",function(){chrome.tabs.create({url:"additional-feature.html"})}),$("#show-advanced").on("click",function(){$(this).hide(),$("#advanced-option").show()})});