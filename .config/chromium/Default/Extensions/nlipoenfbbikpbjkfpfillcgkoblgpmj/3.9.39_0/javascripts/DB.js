function onError(e){console.log("[DB error]: "+e)}window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange);var DB={db:null,log:function(){var e=Array.prototype.slice.apply(arguments);return e.unshift("[DB]: "),console.log.apply(window,e)},init:function(){return new Promise(function(r,n){var e=indexedDB.open("AwesomeScreenshot",1);e.onupgradeneeded=function(e){console.log("onupgradeneeded",e);var r=e.target.result;e.target.transaction.onerror=onError,r.objectStoreNames.contains("recordings")&&r.deleteObjectStore("recordings"),r.createObjectStore("recordings",{autoIncrement:!0}).createIndex("by_id","id",{unique:!0})},e.onsuccess=function(e){DB.db=e.target.result,r(e.target.result)},e.onerror=function(e){onError(e),n(e)}})},save:function(i){var s=this.db;return new Promise(function(e,r){var n=s.transaction(["recordings"],"readwrite").objectStore("recordings"),o=(new Date).getTime(),t=n.put({id:o,fileUrl:i.fileUrl,detail:{title:i.title,youtubeUrl:"",gDriveUrl:"",size:i.size,duration:i.duration,timeStamp:o,thumbnailUrl:""}});t.onsuccess=function(){e(o)},t.onerror=r})},get:function(o){var t=this.db;return new Promise(function(n,e){var r=t.transaction(["recordings"],"readwrite").objectStore("recordings").index("by_id").get(o);r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},getAll:function(){var o=this.db;return new Promise(function(n,e){var r=o.transaction(["recordings"],"readwrite").objectStore("recordings").getAll();r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},_getCursor:function(i){var s=this.db;return new Promise(function(n,e){var r=s.transaction(["recordings"],"readwrite").objectStore("recordings"),o=IDBKeyRange.only(i),t=r.index("by_id").openCursor(o);t.onsuccess=function(e){var r=e.target.result;r&&n(r)},t.onerror=e})},updateYoutubeUrl:function(e,t){var r=this;return new Promise(function(n,o){r._getCursor(e).then(function(e){e.value.detail.youtubeUrl=t;var r=e.update(e.value);r.onsuccess=n,r.onerror=o})})},update:function(i,s){var c=this.db;return new Promise(function(n,e){var r=c.transaction(["recordings"],"readwrite").objectStore("recordings"),o=IDBKeyRange.only(i),t=r.index("by_id").openCursor(o);t.onsuccess=function(e){var r=e.target.result;r&&(r.update(s).onsuccess=function(){n()})},t.onerror=e})},deleteAll:function(){var o=this.db;return new Promise(function(n,e){var r=o.transaction(["recordings"],"readwrite").objectStore("recordings").clear();r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},delete:function(i){var s=this.db;return new Promise(function(n,e){var r=s.transaction(["recordings"],"readwrite").objectStore("recordings"),o=IDBKeyRange.only(i),t=r.index("by_id").openCursor(o);t.onsuccess=function(e){var r=e.target.result;r&&(r.delete().onsuccess=function(){n()})},t.onerror=e})}};